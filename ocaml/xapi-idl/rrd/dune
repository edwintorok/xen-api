(library
 (name xapi_idl_rrd_interface_types)
 (package rrdd-plugin)
 (modules data_source)
 (libraries
   result
   rpclib.core
   rresult
   xapi-idl
   xapi_rrd
 )
 (wrapped false)
 (preprocess (pps ppx_deriving_rpc)))

(library
 (name xapi_idl_rrd_interface)
 (package rrdd-plugin)
 (modules rrd_interface)
 (libraries
   result
   rpclib.core
   rresult
   xapi-idl
   xapi_idl_rrd_interface_types
   xapi_rrd
 )
 (wrapped false)
 (preprocess (pps ppx_deriving_rpc)))

(library
 (name xapi_idl_rrd)
 (package rrdd-plugin)
 (modules (:standard \ data_source rrd_interface rrd_cli))
 (libraries
   rpclib.core
   threads.posix
   xapi-idl
   (re_export xapi_idl_rrd_interface)
   (re_export xapi_idl_rrd_interface_types)
   xapi_rrd
 )
 (wrapped false))

(executable
 (name rrd_cli)
 (public_name rrd-cli)
 (package xapi)
 (modules rrd_cli)
 (modes exe)
 (libraries
   cmdliner
   
   rpclib.cmdliner
   rpclib.core
   rpclib.markdown
   xapi-idl
   xapi_idl_rrd
 ))

(rule
 (alias runtest)
 (deps (:x rrd_cli.exe))
 (package xapi)
 (action (run %{x} --help=plain)))

