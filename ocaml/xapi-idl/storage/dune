(library
 (name xcp_storage_interface_types)
 (modules vdi_automaton)
 (libraries
   result
   rpclib.core
   rresult
   threads
   xapi-idl
 )
 (wrapped false)
 (preprocess (pps ppx_sexp_conv ppx_deriving_rpc)))

(library
 (name xcp_storage_interface)
 (modules storage_interface)
 (libraries
   astring
   result
   rpclib.core
   rpclib.json
   rresult
   xapi-stdext-date
   xapi-idl
   xapi-idl.storage.interface.types
   xapi-log
 )
 (wrapped false)
 (preprocess (pps ppx_sexp_conv ppx_deriving_rpc)))

(library
 (name xcp_storage)
 (modules
  (:standard \ storage_interface storage_test vdi_automaton suite
    vdi_automaton_test))
 (libraries
   rpclib.core
   threads.posix
   xapi-idl
   xapi-idl.storage.interface
   xapi-stdext-date
 )
 (wrapped false)
 (preprocess (pps ppx_sexp_conv ppx_deriving_rpc)))

(test
 (name storage_test)
 (modes exe)
 (modules storage_test)
 (package xapi-idl)
 (libraries
   alcotest
   cmdliner
   dune-build-info
   xapi-idl
   xapi-idl.storage
   xapi-idl.storage.interface
 )
 (preprocess (pps ppx_sexp_conv ppx_deriving_rpc)))

(test
 (name suite)
 (modes exe)
 (modules suite vdi_automaton_test)
 (libraries
   alcotest
   dune-build-info
   xapi-idl.storage.interface
   xapi-idl.storage.interface.types
 )
 (package xapi-idl)
 (deps storage_test.exe))
